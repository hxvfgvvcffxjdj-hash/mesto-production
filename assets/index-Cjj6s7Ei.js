(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const a={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"b9eaf538-9ff5-4f4f-8943-b7ba5741317d","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),te=()=>fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(p),j=()=>fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(p),oe=({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(p),re=e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then(p),ne=({name:e,link:t})=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify({name:e,link:t})}).then(p),se=e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then(p),ce=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(o=>p(o)),ae=e=>{e.classList.toggle("card__like-button_is-active")},le=e=>{e.remove()},ie=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),V=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n},r)=>{const s=ie(),u=s.querySelector(".card__like-button"),c=s.querySelector(".card__control-button_type_delete"),l=s.querySelector(".card__image"),Z=s.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,s.querySelector(".card__title").textContent=e.name,Z.textContent=e.likes?e.likes.length:"0",e.likes.some(ee=>ee._id===r)&&u.classList.add("card__like-button_is-active"),e.owner._id!==r?c.remove():c.addEventListener("click",()=>n(e._id,s)),o&&u.addEventListener("click",()=>o(e._id,u)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),s},H=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",H)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",H)},ue=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},de=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{pe(o,e)})},w=(e,t)=>{const o=e.querySelector(t.submitButtonSelector),n=Array.from(e.querySelectorAll(t.inputSelector));f(o,t),n.forEach(r=>{J(e,r,t)})},pe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);$(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{_e(e,r,t),$(o,n,t)})})},$=(e,t,o)=>{me(e)?f(t,o):q(t,o)},me=e=>e.some(t=>!t.validity.valid),f=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},q=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},_e=(e,t,o)=>{t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?J(e,t,o):ye(e,t,o)},ye=(e,t,o)=>{t.classList.add(o.inputErrorClass);const n=e.querySelector(`#${t.id}-error`);n.textContent=t.validationMessage,n.classList.add(o.errorClass)},J=(e,t,o)=>{t.classList.remove(o.inputErrorClass);const n=e.querySelector(`#${t.id}-error`);n.textContent="",n.classList.remove(o.errorClass)},i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};de(i);const R=document.querySelector(".places__list"),T=document.querySelector(".popup_type_edit"),g=T.querySelector(".popup__form"),z=g.querySelector(".popup__input_type_name"),K=g.querySelector(".popup__input_type_description"),B=document.querySelector(".popup_type_new-card"),_=B.querySelector(".popup__form"),fe=_.querySelector(".popup__input_type_card-name"),he=_.querySelector(".popup__input_type_url"),M=document.querySelector(".popup_type_image"),O=M.querySelector(".popup__image"),Se=M.querySelector(".popup__caption"),ve=document.querySelector(".profile__edit-button"),Ce=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__title"),D=document.querySelector(".profile__description"),F=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),L=P.querySelector(".popup__form"),be=L.querySelector(".popup__input"),U=document.querySelector(".popup_type_remove-card"),G=U.querySelector(".popup__form"),E=document.querySelector(".popup_type_info"),Le=E.querySelector(".popup__title"),m=E.querySelector(".popup__info"),qe=E.querySelector(".popup__text"),N=E.querySelector(".popup__list"),ge=document.querySelector(".header__logo"),h=g.querySelector(".popup__button"),S=_.querySelector(".popup__button"),v=L.querySelector(".popup__button"),C=G.querySelector(".popup__button"),Q=({name:e,link:t})=>{O.src=t,O.alt=e,Se.textContent=e,y(M)},Ee=e=>{e.preventDefault();const t=h.textContent;h.textContent="Сохранение...",f(h,i),oe({name:z.value,about:K.value}).then(o=>{A.textContent=o.name,D.textContent=o.about,d(T)}).catch(o=>{console.log(o)}).finally(()=>{h.textContent=t,q(h,i)})},ke=e=>{e.preventDefault();const t=v.textContent;v.textContent="Сохранение...",f(v,i),re(be.value).then(o=>{F.style.backgroundImage=`url(${o.avatar})`,d(P)}).catch(o=>{console.log(o)}).finally(()=>{v.textContent=t,q(v,i)})},xe=e=>{e.preventDefault();const t=S.textContent;S.textContent="Создание...",f(S,i),ne({name:fe.value,link:he.value}).then(o=>{R.prepend(V(o,{onPreviewPicture:Q,onLikeIcon:Y,onDeleteCard:X},I)),d(B)}).catch(o=>{console.log(o)}).finally(()=>{S.textContent=t,q(S,i)})};let k=null,x=null;const X=(e,t)=>{k=e,x=t,y(U)},Ie=e=>{e.preventDefault();const t=C.textContent;C.textContent="Удаление...",f(C,i),se(k).then(o=>{le(x),d(U),k=null,x=null}).catch(o=>{console.log(o)}).finally(()=>{C.textContent=t,q(C,i)})},Y=(e,t)=>{const o=t.classList.contains("card__like-button_is-active");ce(e,o).then(n=>{const r=t.parentElement.querySelector(".card__like-count");r&&(r.textContent=n.likes.length),ae(t)}).catch(n=>{console.log(n)})},W=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),b=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},we=()=>{j().then(e=>{m.innerHTML="",N.innerHTML="";let t=null,o=null;e.length>0&&(t=e[0],o=e[0],e.forEach(c=>{const l=new Date(c.createdAt);l<new Date(t.createdAt)&&(t=c),l>new Date(o.createdAt)&&(o=c)}));const n={};e.forEach(c=>{const l=c.owner._id;n[l]||(n[l]={name:c.owner.name,cardCount:0}),n[l].cardCount++});const r=Object.values(n);let s=0;for(const c in r)r[c].cardCount>s&&(s=r[c].cardCount);Le.textContent="Статистика пользователей",m.append(b("Всего карточек:",e.length.toString())),e.length>0&&(m.append(b("Первая создана:",W(new Date(t.createdAt)))),m.append(b("Последняя создана:",W(new Date(o.createdAt))))),m.append(b("Всего пользователей:",r.length.toString())),m.append(b("Максимум карточек от одного:",s.toString())),qe.textContent="Все пользователи:";const u=document.getElementById("popup-info-user-preview-template");r.forEach(c=>{const l=u.content.cloneNode(!0).querySelector(".popup__list-item");l.textContent=c.name,N.append(l)}),y(E)}).catch(e=>{console.log(e)})};ge.addEventListener("click",we);g.addEventListener("submit",Ee);_.addEventListener("submit",xe);L.addEventListener("submit",ke);G.addEventListener("submit",Ie);ve.addEventListener("click",()=>{z.value=A.textContent,K.value=D.textContent,w(g,i),y(T)});F.addEventListener("click",()=>{L.reset(),w(L,i),y(P)});Ce.addEventListener("click",()=>{_.reset(),w(_,i),y(B)});const Te=document.querySelectorAll(".popup");Te.forEach(e=>{ue(e)});let I=null;Promise.all([j(),te()]).then(([e,t])=>{I=t._id,e.forEach(o=>{R.append(V(o,{onPreviewPicture:Q,onLikeIcon:Y,onDeleteCard:X},I))}),F.style.backgroundImage=`url(${t.avatar})`,A.textContent=t.name,D.textContent=t.about}).catch(e=>{console.log(e)});
